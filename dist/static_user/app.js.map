{"version":3,"file":"app.js","sourceRoot":"","sources":["../../client_user/polyfills.ts","../../client_user/tools.tsx","../../client_user/app.tsx"],"names":[],"mappings":"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","sourcesContent":["\r\n// https://tc39.github.io/ecma262/#sec-array.prototype.find\r\nif (!(Array.prototype as any).find) {\r\n\tObject.defineProperty(Array.prototype, 'find', {\r\n\t\tvalue(predicate: any) {\r\n\t\t\t// 1. Let O be ? ToObject(this value).\r\n\t\t\tif (this == null) {\r\n\t\t\t\tthrow new TypeError('\"this\" is null or not defined');\r\n\t\t\t}\r\n\r\n\t\t\tconst o = Object(this);\r\n\r\n\t\t\t// 2. Let len be ? ToLength(? Get(O, \"length\")).\r\n\t\t\tconst len = o.length >>> 0;\r\n\r\n\t\t\t// 3. If IsCallable(predicate) is false, throw a TypeError exception.\r\n\t\t\tif (typeof predicate !== 'function') {\r\n\t\t\t\tthrow new TypeError('predicate must be a function');\r\n\t\t\t}\r\n\r\n\t\t\t// 4. If thisArg was supplied, let T be thisArg; else let T be undefined.\r\n\t\t\tconst thisArg = arguments[1];\r\n\r\n\t\t\t// 5. Let k be 0.\r\n\t\t\tlet k = 0;\r\n\r\n\t\t\t// 6. Repeat, while k < len\r\n\t\t\twhile (k < len) {\r\n\t\t\t\t// a. Let Pk be ! ToString(k).\r\n\t\t\t\t// b. Let kValue be ? Get(O, Pk).\r\n\t\t\t\t// c. Let testResult be ToBoolean(? Call(predicate, T, « kValue, k, O »)).\r\n\t\t\t\t// d. If testResult is true, return kValue.\r\n\t\t\t\tconst kValue = o[k];\r\n\t\t\t\tif (predicate.call(thisArg, kValue, k, o)) {\r\n\t\t\t\t\treturn kValue;\r\n\t\t\t\t}\r\n\t\t\t\t// e. Increase k by 1.\r\n\t\t\t\tk++;\r\n\t\t\t}\r\n\r\n\t\t\t// 7. Return undefined.\r\n\t\t\treturn undefined;\r\n\t\t},\r\n\t\tconfigurable: true,\r\n\t\twritable: true\r\n\t});\r\n}\r\n\r\n\r\n// from:https://github.com/jserz/js_piece/blob/master/DOM/ChildNode/remove()/remove().md\r\n[Element.prototype, CharacterData.prototype, DocumentType.prototype].forEach(item => {\r\n\tif (item.hasOwnProperty('remove')) {\r\n\t\treturn;\r\n\t}\r\n\tObject.defineProperty(item, 'remove', {\r\n\t\tconfigurable: true,\r\n\t\tenumerable: true,\r\n\t\twritable: true,\r\n\t\tvalue: function remove() {\r\n\t\t\tif (this.parentNode)\r\n\t\t\t\tthis.parentNode.removeChild(this);\r\n\t\t}\r\n\t});\r\n});\r\n\r\n\r\nif (!Math.trunc) {\r\n\tMath.trunc = v => {\r\n\t\tv = +v;\r\n\t\treturn !isFinite(v) ? v :\r\n\t\t\t(v - v % 1) || (v < 0 ? -0 : v === 0 ? v : 0);\r\n\t};\r\n}\r\n\r\n\r\nif (!Math.log10)\r\n\tMath.log10 = x => Math.log(x) * Math.LOG10E;\r\n","//import * as React from \"./react\";\r\n\r\nfunction pad(num: number | string, size: number) { let s = num + \"\"; while (s.length < size) s = \"0\" + s; return s; }\r\nfunction formatDate(d: Date) { return `${d.getDate()}. ${d.getMonth() + 1}. ${d.getFullYear()} ${d.getHours()}:${pad(d.getMinutes(), 2)}:${pad(d.getSeconds(), 2)} (UTC+${-d.getTimezoneOffset() / 60})`; }\r\nfunction linInp(x: number, x1From: number, x1To: number, x2From: number, x2To: number) { return (x - x1From) / (x1To - x1From) * (x2To - x2From) + x2From; }\r\nfunction nextDay1(d: Date, step: number) { return new Date(d.getFullYear(), d.getMonth(), d.getDate() + step); }\r\n\r\n\r\n\r\n\r\nfunction setAttr(element: Element, attrs: { [k: string]: string | number | React.CSSProperties }) {\r\n\tObject.keys(attrs).forEach(k => {\r\n\t\tconst v = attrs[k];\r\n\t\t//if (element.hasAttribute(k) && typeof v === \"string\")\r\n\t\t//\telement.setAttribute(k, v);\r\n\t\t//else\r\n\t\tif (!(k in element))\r\n\t\t\tconsole.error(`${k} is not a valid property name, <${element.tagName} ${k}={${v}}>`);\r\n\t\telse if (typeof v === \"string\")\r\n\t\t\telement[k] = v;\r\n\t\telse if (typeof v === \"number\")\r\n\t\t\telement[k] = v.toString();\r\n\t\telse if (v === null)\r\n\t\t\tconsole.error(`${v} is not a valid property value, <${element.tagName} ${k}={${v}}>`);\r\n\t\telse if (typeof v === \"object\")\r\n\t\t\tObject.keys(v).forEach(k2 => {\r\n\t\t\t\tif (k2 in element[k])\r\n\t\t\t\t\telement[k][k2] = v[k2];\r\n\t\t\t\telse\r\n\t\t\t\t\tconsole.error(`${k2} is not a valid ${k}, <${element.tagName} ${k}={{ ${k2}: ... }}>`);\r\n\t\t\t});\r\n\t\telse if (typeof v === \"boolean\" && typeof element[k] === \"boolean\")\r\n\t\t\telement[k] = v;\r\n\t\telse if (typeof v === \"function\" && [\"onclick\", \"onchange\", \"ontouchstart\", \"ontouchend\", \"onkeypress\",].indexOf(k) !== -1)\r\n\t\t\telement[k] = v;\r\n\t\telse\r\n\t\t\tconsole.error(`${v} is not a valid property value, <${element.tagName} ${k}={${v}}>`, v);\r\n\t});\r\n}\r\nfunction setStyle(element: HTMLElement, styles: React.CSSProperties) {\r\n\tsetAttr(element, { style: styles });\r\n}\r\nfunction setAttrSvg(element: SVGElement, attrs: { [k: string]: string | number | React.CSSProperties }) {\r\n\tObject.keys(attrs).forEach(k => {\r\n\t\tconst v = attrs[k];\r\n\t\t//if (!(k in element))\r\n\t\t//\tconsole.error(`${k} is not a valid property of a <${element.tagName}>`);\r\n\t\t//else\r\n\t\tif (typeof v === \"string\")\r\n\t\t\telement.setAttribute(k, v);\r\n\t\telse if (typeof v === \"number\")\r\n\t\t\telement.setAttribute(k, v.toString());\r\n\t\telse if (v === null)\r\n\t\t\tconsole.error(`${v} is not a valid property value, <${element.tagName} ${k}={${v}}>`);\r\n\t\telse if (typeof v === \"object\")\r\n\t\t\tObject.keys(v).forEach(k2 => {\r\n\t\t\t\tif (k2 in element[k])\r\n\t\t\t\t\telement[k][k2] = v[k2];\r\n\t\t\t\telse\r\n\t\t\t\t\tconsole.error(`${k2} is not a valid ${k}, <${element.tagName} ${k}={{ ${k2}: ... }}>`);\r\n\t\t\t});\r\n\t\t//else if (typeof v === \"boolean\" && typeof element[k] === \"boolean\")\r\n\t\t//\telement[k] = v;\r\n\t\t//else if (typeof v === \"function\" && k === \"onclick\")\r\n\t\t//\telement[k] = v;\r\n\t\telse\r\n\t\t\tconsole.error(`${v} is not a valid property value, <${element.tagName} ${k}={${v}}>`, v);\r\n\t});\r\n}\r\n\r\n\r\ntype TChild = string | number | Node | TChild[];\r\nfunction ac<T extends Element>(element: T, ...children: TChild[]) {\r\n\tchildren.forEach(c => {\r\n\t\tif (typeof c === \"string\")\r\n\t\t\telement.appendChild(document.createTextNode(c));\r\n\t\telse if (typeof c === \"number\")\r\n\t\t\telement.appendChild(document.createTextNode(c.toString()));\r\n\t\telse if (c instanceof Node)\r\n\t\t\telement.appendChild(c);\r\n\t\telse if (c instanceof Array)\r\n\t\t\tac(element, ...c);\r\n\t\telse\r\n\t\t\tconsole.error(`${c} is not a valid child, <${element.tagName}>{${c}}</${element.tagName}>`, c);\r\n\t});\r\n\treturn element;\r\n}\r\n\r\n\r\nfunction myCreateElement<T extends keyof ElementTagNameMap/*, U*/>(tag: T/* | ((props: any) => U)*/, attrs: { [k: string]: string | number | React.CSSProperties } | null, ...children: TChild[]) {\r\n\t//if (typeof tag === \"function\")\r\n\t//\treturn tag({ ...attrs, children });\r\n\tif ([\"svg\", \"path\", \"circle\", \"rect\", \"polyline\", \"text\", \"g\", \"clipPath\", \"defs\",].indexOf(tag) >= 0) {\r\n\t\tconst element = document.createElementNS(\"http://www.w3.org/2000/svg\", tag);\r\n\t\tif (attrs !== null)\r\n\t\t\tsetAttrSvg(element, attrs);\r\n\t\treturn ac(element, ...children);\r\n\t} else {\r\n\t\tconst element = document.createElement(tag);\r\n\t\tif (attrs !== null)\r\n\t\t\tsetAttr(element, attrs);\r\n\t\treturn ac(element, ...children);\r\n\t}\r\n}\r\n\r\n\r\n\r\n\r\n\r\ntype Func<A1, Ret> = (a: A1) => Ret;\r\nfunction toDictionary<T, TKey extends keyof any, TValue>(arr: T[], keySelector: Func<T, TKey>, valueSelector: Func<T, TValue>) {\r\n\tconst ret: Record<TKey, TValue> = {} as Record<TKey, TValue>;\r\n\tarr.forEach(p => ret[keySelector(p)] = valueSelector(p));\r\n\treturn ret;\r\n}\r\n\r\n\r\nfunction range(n: number) { return Array.from(Array(n).keys()); }\r\n\r\n\r\n\r\nfunction setTimeoutA(ms: number): Promise<void> {\r\n\treturn new Promise((resolve, reject) => setTimeout(resolve, ms));\r\n}\r\n","/*\r\n\tgoals: fisheye projection, config similar to betaflight, scene without borders, low hw requirements, crosshair in osd, draw own horizon in osd, allow control also with keyboard/mouse\r\n\r\n\r\n\thttps://github.com/shaunlebron/blinky (?)\r\n\r\n\tlights, textures, shadows, https://webgl2fundamentals.org, https://developer.download.nvidia.com/CgTutorial/cg_tutorial_chapter07.html, https://google.github.io/filament/Filament.html\r\n\t\thttps://www.pixijs.com/, https://unity.com\r\n\tfisheye, https://github.com/shaunlebron/blinky, https://pvdz.ee/weblog/340\r\n\t\thttps://en.wikipedia.org/wiki/3D_projection, https://en.wikipedia.org/wiki/Curvilinear_perspective, https://en.wikipedia.org/wiki/Fisheye_lens\r\n\r\n\r\n\r\n\trepo on github\r\n\t2. channel (pitch) is noisy after connectiong my rc with usb (it's ok with FeiYing). can it be corrected with some filter? what filter is in betaflight (if any)?\r\n\tmap/scene\r\n\tcollisions\r\n\tphysics (random gusts of wind; spark chart for position, velocity, inputs)\r\n\tgamepad: channel assignments, calibration, selection when multiple gamepads (gamepad.index)\r\n\tmatrix normalization (how much is it denormalizing with time?)\r\n\ticon, own radiobutton (it does not click when mouse moves), save settings in url\r\n\tangle, horizon, (acro), 3d\r\n\tcontrol with mouse (?)\r\n\tload parameters from betaflight export\r\n\r\n\r\n\t\t\tvertex\t\t\t\t\t\t\t\t\tfragment\r\ninputs\r\n\t\t\tattributes (pulled from buffers)\t\tvaryings (interpolated data from vertex shader)\r\n\t\t\tuniforms (same for all vertices)\t\tuniforms (same for all pixels)\r\n\t\t\ttextures\t\t\t\t\t\t\t\ttextures\r\noutputs\r\n\t\t\tgl_Position\t\t\t\t\t\t\t\toutColor (for frameBuffer or renderBuffer)\r\n\t\t\t[varyings]\r\n*/\r\n\r\n/// <reference path=\"twgl-full.d.ts\" />\r\n/// <reference path=\"csstype.d.ts\" />\r\n/// <reference path=\"react.d.ts\" />\r\n/// <reference path=\"polyfills.ts\" />\r\n/// <reference path=\"tools.tsx\" />\r\ndeclare const textureUtils: any;\r\ndeclare const chroma: any;\r\n\r\n\r\n\r\n\r\nmain();\r\nfunction main() {\r\n\r\n\tlet canvas: HTMLCanvasElement;\r\n\tlet osd: HTMLCanvasElement;\r\n\tlet divFps: HTMLElement;\r\n\tlet divSticks: HTMLElement;\r\n\tlet inputControlRC: HTMLInputElement;\r\n\tlet inputControlGamepad: HTMLInputElement;\r\n\tlet inputControlKb: HTMLInputElement;\r\n\tlet inputControlDuke: HTMLInputElement;\r\n\tlet spanCameraAngle: HTMLElement;\r\n\tlet inputCameraAngle: HTMLInputElement;\r\n\tlet spanFov: HTMLElement;\r\n\tlet inputFov: HTMLInputElement;\r\n\tconst spanPosition: HTMLElement[] = [];\r\n\tconst spanVelocity: HTMLElement[] = [];\r\n\tconst spanLRxy: HTMLElement[] = [];\r\n\tac(document.body,\r\n\t\t<div>\r\n\t\t\t<div style={{ position: \"relative\", }}>\r\n\t\t\t\t{canvas = <canvas width=\"640\" height=\"480\" style={{ border: \"1px solid #ccc\", }} /> as HTMLCanvasElement}\r\n\t\t\t\t{osd = <canvas width=\"640\" height=\"480\" style={{ border: \"1px solid #ccc\", position: \"absolute\", left: \"0px\", top: \"0px\", }} /> as HTMLCanvasElement}\r\n\t\t\t</div>\r\n\t\t\t<div style={{ position: \"relative\", height: \"60px\", }}>\r\n\t\t\t\t{divFps = <div style={{ position: \"absolute\", left: \"0px\", top: \"0px\", }} />}\r\n\t\t\t\t{divSticks = <div style={{ position: \"absolute\", left: \"100px\", top: \"0px\", }} />}\r\n\t\t\t</div>\r\n\t\t\t<div>control:\r\n\t\t\t\t<label style={{ marginRight: \"5px\", }}>{inputControlRC = <input type=\"radio\" name=\"control\" checked /> as HTMLInputElement}RC</label>\r\n\t\t\t\t<label style={{ marginRight: \"5px\", }}>{inputControlGamepad = <input type=\"radio\" name=\"control\" /> as HTMLInputElement}Gamepad</label>\r\n\t\t\t\t<label style={{ marginRight: \"5px\", }}>{inputControlKb = <input type=\"radio\" name=\"control\" /> as HTMLInputElement}Keyboard (left stick: wasd, right stick: arrows)</label>\r\n\t\t\t\t<label style={{ marginRight: \"5px\", display: \"none\", }}>{inputControlDuke = <input type=\"radio\" name=\"control\" /> as HTMLInputElement}Duke (wasd, ctrl, space, arrows)</label>\r\n\t\t\t\t<br /><label style={{ marginLeft: \"53px\", marginRight: \"5px\", }}><input type=\"radio\" name=\"mode\" checked />Mode 2</label>\r\n\t\t\t</div>\r\n\t\t\t<table style={{ borderCollapse: \"collapse\", }}>\r\n\t\t\t\t<tr><td>camera:</td><td>\r\n\t\t\t\t\tangle: {spanCameraAngle = <span style={{ display: \"inline-block\", width: \"20px\", }} />} {inputCameraAngle = <input type=\"range\" min=\"0\" max=\"90\" value=\"30\" style={{ width: \"300px\", height: \"15px\", verticalAlign: \"middle\", }} /> as HTMLInputElement}\r\n\t\t\t\t</td></tr>\r\n\t\t\t\t<tr><td /><td>\r\n\t\t\t\t\tfov: {spanFov = <span style={{ display: \"inline-block\", width: \"37px\", }} />} {inputFov = <input type=\"range\" min=\"0\" max=\"360\" value=\"120\" style={{ width: \"300px\", height: \"15px\", verticalAlign: \"middle\", }} /> as HTMLInputElement}\r\n\t\t\t\t\t<span className=\"userSelectNone\" style={{ color: \"#888\", marginLeft: \"10px\", cursor: \"pointer\", }} onclick={() => { inputFov.value = inputFov.max = `${+inputFov.max * 2}`; fillFov(); }}>(more)</span>\r\n\t\t\t\t</td></tr>\r\n\t\t\t</table>\r\n\t\t\t<div>position [m] x: {spanPosition[0] = <span />}, y: {spanPosition[1] = <span />}, z: {spanPosition[2] = <span />}</div>\r\n\t\t\t<div>velocity [km/h] x: {spanVelocity[0] = <span />}, y: {spanVelocity[1] = <span />}, z: {spanVelocity[2] = <span />}</div>\r\n\t\t\t<div>lx: {spanLRxy[0] = <span />}, ly: {spanLRxy[1] = <span />}, rx: {spanLRxy[2] = <span />}, ry: {spanLRxy[3] = <span />}</div>\r\n\t\t</div>\r\n\t);\r\n\r\n\tdrawOsd(osd);\r\n\r\n\tconst fps = createFps(divFps);\r\n\r\n\tconst stickL = createStick(false);\r\n\tconst stickR = createStick(true);\r\n\tconst gamepadMgr = createGamepadManager();\r\n\tac(divSticks, stickL.svg, <span style={{ display: \"inline-block\", width: \"10px\", }} />, stickR.svg);\r\n\r\n\tfillCameraAngle();\r\n\tinputCameraAngle.oninput = fillCameraAngle;\r\n\tfunction fillCameraAngle() { spanCameraAngle.innerText = `${Math.round(getCameraAngle())}`; }\r\n\tfunction getCameraAngle() { return +inputCameraAngle.value; }\r\n\r\n\tfillFov();\r\n\tinputFov.oninput = fillFov;\r\n\tfunction fillFov() { spanFov.innerText = `${Math.round(getFov())}`; }\r\n\tfunction getFov() { return +inputFov.value; }\r\n\r\n\r\n\r\n\r\n\tconst helper = createWebGLHelper(canvas);\r\n\tconst gl = helper.gl;\r\n\r\n\tconst envmapVertexShaderSource = `#version 300 es\r\n\t\t\t\tuniform mat4 u_worldViewProjection;\r\n\t\t\t\tuniform vec3 u_lightWorldPos;\r\n\t\t\t\tuniform mat4 u_world;\r\n\t\t\t\tuniform mat4 u_viewInverse;\r\n\t\t\t\tuniform mat4 u_worldInverseTranspose;\r\n\t\t\t\tin vec4 a_position;\r\n\t\t\t\tin vec3 a_normal;\r\n\t\t\t\tin vec2 a_texcoord;\r\n\t\t\t\tout vec4 v_position;\r\n\t\t\t\tout vec2 v_texCoord;\r\n\t\t\t\tout vec3 v_normal;\r\n\t\t\t\tout vec3 v_surfaceToLight;\r\n\t\t\t\tout vec3 v_surfaceToView;\r\n\t\t\t\tvoid main() {\r\n\t\t\t\t\tv_texCoord = a_texcoord;\r\n\t\t\t\t\tv_position = u_worldViewProjection * a_position;\r\n\t\t\t\t\tv_normal = (u_worldInverseTranspose * vec4(a_normal, 0)).xyz;\r\n\t\t\t\t\tv_surfaceToLight = u_lightWorldPos - (u_world * a_position).xyz;\r\n\t\t\t\t\tv_surfaceToView = (u_viewInverse[3] - u_world * a_position).xyz;\r\n\t\t\t\t\tgl_Position = v_position;\r\n\t\t\t\t}\r\n\t\t\t`;\r\n\tconst envmapFragmentShaderSource = `#version 300 es\r\n\t\t\t\tprecision highp float;\r\n\t\t\t\tin vec4 v_position;\r\n\t\t\t\tin vec2 v_texCoord;\r\n\t\t\t\tin vec3 v_normal;\r\n\t\t\t\tin vec3 v_surfaceToLight;\r\n\t\t\t\tin vec3 v_surfaceToView;\r\n\t\t\t\tuniform vec4 u_lightColor;\r\n\t\t\t\tuniform vec4 u_colorMult;\r\n\t\t\t\tuniform sampler2D u_diffuse;\r\n\t\t\t\tuniform vec4 u_specular;\r\n\t\t\t\tuniform float u_shininess;\r\n\t\t\t\tuniform float u_specularFactor;\r\n\t\t\t\tout vec4 outColor;\r\n\t\t\t\tvec4 lit(float l ,float h, float m) {\r\n\t\t\t\t\treturn vec4(1.0, abs(l), l > 0.0 ? pow(max(0.0, h), m) : 0.0, 1.0);\r\n\t\t\t\t}\r\n\t\t\t\tvoid main() {\r\n\t\t\t\t\tvec4 diffuseColor = texture(u_diffuse, v_texCoord);\r\n\t\t\t\t\tvec3 a_normal = normalize(v_normal);\r\n\t\t\t\t\tvec3 surfaceToLight = normalize(v_surfaceToLight);\r\n\t\t\t\t\tvec3 surfaceToView = normalize(v_surfaceToView);\r\n\t\t\t\t\tvec3 halfVector = normalize(surfaceToLight + surfaceToView);\r\n\t\t\t\t\tvec4 litR = lit(dot(a_normal, surfaceToLight),\r\n\t\t\t\t\tdot(a_normal, halfVector), u_shininess);\r\n\t\t\t\t\t//outColor = vec4((u_lightColor * (diffuseColor * litR.y * u_colorMult + u_specular * litR.z * u_specularFactor)).rgb, diffuseColor.a);\r\n\t\t\t\t\tvec3 ambientColor = diffuseColor.rgb * 0.2;\r\n\t\t\t\t\toutColor = vec4((u_lightColor * (diffuseColor * litR.y * u_colorMult + u_specular * litR.z * u_specularFactor)).rgb + ambientColor, diffuseColor.a);\r\n\t\t\t\t}\r\n\t\t\t`;\r\n\r\n\tconst envData = twgl.primitives.createSphereVertices(10, 48, 24);\r\n\tconst auxProgram = helper.createProgram(envmapVertexShaderSource, envmapFragmentShaderSource, [\r\n\t\t{ attributeName: \"a_position\", bufferData: envData.position, indexBufferData: envData.indices, onePointSize: 3, normalize: false, },\r\n\t\t{ attributeName: \"a_normal\", bufferData: envData.normal, onePointSize: 3, normalize: false, },\r\n\t\t{ attributeName: \"a_texcoord\", bufferData: envData.texcoord, onePointSize: 2, normalize: false, },\r\n\t]);\r\n\tconst u_viewInverse = auxProgram.getUniformLocation(\"u_viewInverse\");\r\n\tconst u_lightWorldPos = auxProgram.getUniformLocation(\"u_lightWorldPos\");\r\n\tconst u_lightColor = auxProgram.getUniformLocation(\"u_lightColor\");\r\n\tconst u_world = auxProgram.getUniformLocation(\"u_world\");\r\n\tconst u_worldViewProjection = auxProgram.getUniformLocation(\"u_worldViewProjection\");\r\n\tconst u_worldInverseTranspose = auxProgram.getUniformLocation(\"u_worldInverseTranspose\");\r\n\tconst u_colorMult = auxProgram.getUniformLocation(\"u_colorMult\");\r\n\tconst u_diffuse = auxProgram.getUniformLocation(\"u_diffuse\");\r\n\tconst u_specular = auxProgram.getUniformLocation(\"u_specular\");\r\n\tconst u_shininess = auxProgram.getUniformLocation(\"u_shininess\");\r\n\tconst u_specularFactor = auxProgram.getUniformLocation(\"u_specularFactor\");\r\n\r\n\tconst planeData = twgl.primitives.createPlaneVertices(2000, 2000);\r\n\tplaneData.texcoord.forEach((v, i) => planeData.texcoord[i] *= 1000);\r\n\tconst planeVAO = auxProgram.createVAO([\r\n\t\t{ bufferData: planeData.position, indexBufferData: planeData.indices, onePointSize: 3, normalize: false, },\r\n\t\t{ bufferData: planeData.normal, onePointSize: 3, normalize: false, },\r\n\t\t{ bufferData: planeData.texcoord, onePointSize: 2, normalize: false, },\r\n\t]);\r\n\r\n\t// make a 8x8 checkerboard texture\r\n\tconst checkerboardTexture = helper.createAndBindTexture();\r\n\tgl.pixelStorei(gl.UNPACK_ALIGNMENT, 1);\r\n\tgl.texImage2D(gl.TEXTURE_2D, 0, gl.LUMINANCE, 2, 2, 0, gl.LUMINANCE, gl.UNSIGNED_BYTE, new Uint8Array([0xFF, 0xCC, 0xCC, 0xFF,]));\r\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\r\n\tgl.generateMipmap(gl.TEXTURE_2D);\r\n\r\n\r\n\tfunction degToRad(d: number) {\r\n\t\treturn d * Math.PI / 180;\r\n\t}\r\n\tlet seed = 1;\r\n\tfunction myRandom() {\r\n\t\t//return Math.random();\r\n\t\treturn (Math.sin(seed++) + 1) * 10000 % 1;\r\n\t}\r\n\tfunction rand(min: number, max?: number) {\r\n\t\tif (max === undefined)\r\n\t\t\t[min, max] = [0, min,];\r\n\t\treturn min + myRandom() * (max - min);\r\n\t}\r\n\tfunction randInt(range: number) {\r\n\t\treturn Math.floor(myRandom() * range);\r\n\t}\r\n\r\n\tconst textures: WebGLTexture[] = [\r\n\t\ttextureUtils.makeStripeTexture(gl, { color1: \"#FFF\", color2: \"#CCC\", }),\r\n\t\ttextureUtils.makeCheckerTexture(gl, { color1: \"#FFF\", color2: \"#CCC\", }),\r\n\t\ttextureUtils.makeCircleTexture(gl, { color1: \"#FFF\", color2: \"#CCC\", }),\r\n\t];\r\n\r\n\tconst numObjects = 30;\r\n\tconst baseColor = rand(240);\r\n\tconst objects = range(numObjects).map(ii => {\r\n\t\treturn {\r\n\t\t\tradius: rand(150),\r\n\t\t\txRotation: rand(Math.PI * 2),\r\n\t\t\tyRotation: rand(Math.PI),\r\n\t\t\tmaterialUniforms: {\r\n\t\t\t\tu_colorMult: chroma.hsv(rand(baseColor, baseColor + 120), 0.5, 1).gl(),\r\n\t\t\t\tu_diffuse: textures[randInt(textures.length)],\r\n\t\t\t\tu_specular: [1, 1, 1, 1],\r\n\t\t\t\tu_shininess: rand(500),\r\n\t\t\t\tu_specularFactor: rand(1),\r\n\t\t\t},\r\n\t\t};\r\n\t});\r\n\r\n\r\n\r\n\r\n\r\n\r\n\tconst skyboxVertexShaderSource = `#version 300 es\r\n\t\t\t\tin vec4 a_position;\r\n\t\t\t\tout vec4 v_position;\r\n\t\t\t\tvoid main() {\r\n\t\t\t\t\tv_position = a_position;\r\n\t\t\t\t\tgl_Position = vec4(a_position.xy, 1, 1);\r\n\t\t\t\t}\r\n\t\t\t\t`;\r\n\tconst skyboxFragmentShaderSource = `#version 300 es\r\n\t\t\t\t#define PI 3.14159265359\r\n\t\t\t\tprecision highp float;\r\n\t\t\t\tuniform samplerCube u_skybox;\r\n\t\t\t\tuniform float u_aspect;\r\n\t\t\t\tuniform float u_fov;\r\n\t\t\t\tin vec4 v_position;\r\n\t\t\t\tout vec4 outColor;\t// we need to declare an output for the fragment shader\r\n\t\t\t\tvoid main() {\r\n\t\t\t\t\tvec2 a = vec2(v_position.x, v_position.y / u_aspect);\r\n\t\t\t\t\t//vec2 a = vec2(v_position.x * u_aspect, v_position.y);\r\n\t\t\t\t\tfloat len = length(a.xy);// + 0.0001;\r\n\t\t\t\t\tfloat len2 = len * u_fov / 2.;\r\n\t\t\t\t\tfloat roll = PI / 2. - (a.x > 0. ? asin(a.y / len) : PI - asin(a.y / len));\r\n\t\t\t\t\toutColor = texture(u_skybox, vec3(sin(len2) * sin(roll), sin(len2) * cos(roll), -cos(len2)), 0.);\r\n\t\t\t\t}\r\n\t\t\t\t`;\r\n\tconst skyData = twgl.primitives.createXYQuadVertices();\r\n\tconst auxProgramSky = helper.createProgram(skyboxVertexShaderSource, skyboxFragmentShaderSource, [\r\n\t\t{ attributeName: \"a_position\", bufferData: new Float32Array(skyData.position.data), indexBufferData: new Uint16Array(skyData.indices), onePointSize: 2, normalize: false, },\r\n\t]);\r\n\tconst u_skybox = auxProgramSky.getUniformLocation(\"u_skybox\");\r\n\tconst u_aspect = auxProgramSky.getUniformLocation(\"u_aspect\");\r\n\tconst u_fov = auxProgramSky.getUniformLocation(\"u_fov\");\r\n\r\n\r\n\t// Create a texture to render to\r\n\tconst targetTextureWH = 1024;\r\n\tconst targetTexture = helper.createAndBindTexture(gl.TEXTURE_CUBE_MAP);\r\n\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_LINEAR);\r\n\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\r\n\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\r\n\tgl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\r\n\trange(6).forEach(i => gl.texImage2D(gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, gl.RGBA, targetTextureWH, targetTextureWH, 0, gl.RGBA, gl.UNSIGNED_BYTE, null));\r\n\r\n\r\n\tconst fbs = range(6).map(i => {\r\n\t\t// Create framebuffer\r\n\t\tconst inscatterFrameBuffers_i = gl.createFramebuffer();\r\n\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, inscatterFrameBuffers_i);\r\n\r\n\t\t// Create and attach depth buffer\r\n\t\tconst inscatterDepthBuffers_i = gl.createRenderbuffer();\r\n\t\tgl.bindRenderbuffer(gl.RENDERBUFFER, inscatterDepthBuffers_i);\r\n\t\tgl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_COMPONENT16, targetTextureWH, targetTextureWH);\r\n\t\tgl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, inscatterDepthBuffers_i);\r\n\t\tgl.bindRenderbuffer(gl.RENDERBUFFER, null);\r\n\r\n\t\t// Attach one face of cube map\r\n\t\tgl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_CUBE_MAP_POSITIVE_X + i, targetTexture, 0);\r\n\r\n\t\tconst status = gl.checkFramebufferStatus(gl.FRAMEBUFFER);\r\n\t\tif (status !== gl.FRAMEBUFFER_COMPLETE)\r\n\t\t\tconsole.warn(\"Inscatter frame buffer, \" + i + \", is not complete: \" + helper.glEnumToString(status));\r\n\r\n\t\treturn { fb: inscatterFrameBuffers_i, depth: inscatterDepthBuffers_i, };\r\n\t});\r\n\r\n\r\n\r\n\t//canvas.tabIndex = 0;\r\n\t//canvas.classList.add(\"showFocus\");\r\n\t//canvas.focus();\r\n\t//canvas.addEventListener(\"focus\", () => console.log(\"got focus\"));\r\n\t//canvas.addEventListener(\"blur\", () => console.log(\"lost focus\"));\r\n\tconst keys = { KeyA: false, KeyS: false, KeyD: false, KeyW: false, ArrowLeft: false, ArrowRight: false, ArrowUp: false, ArrowDown: false, ControlLeft: false, Space: false, };\r\n\tdocument.addEventListener(\"keydown\", e => {\r\n\t\tkeys[e.code] = true;\r\n\t\t//console.log(e.code);\r\n\t\tif (!(e.ctrlKey && (e.code === \"KeyR\" || e.code === \"Numpad0\" || e.code === \"NumpadAdd\" || e.code === \"NumpadSubtract\") || e.code === \"F12\"))\r\n\t\t\te.preventDefault()\r\n\t});\r\n\tdocument.addEventListener(\"keyup\", e => keys[e.code] = false);\r\n\r\n\r\n\r\n\tconst droneMatrix = twgl.m4.lookAt([0, 10, 200], [0, 10, 0], [0, 1, 0]);\r\n\tconst cameraVelocity = twgl.v3.create();\r\n\tconst worldViewProjection = twgl.m4.identity();\r\n\tconst worldInverseTranspose = twgl.m4.identity();\r\n\r\n\r\n\trequestAnimationFrame(drawScene);\r\n\r\n\t// Draw the scene.\r\n\tlet lastTime = NaN;\r\n\tlet lastInputControlDuke_checked = false;\r\n\tfunction drawScene(time: number) {\r\n\t\tfps.inc();\r\n\r\n\t\tconst timeDelta_s = isNaN(lastTime) ? 0 : (time - lastTime) * 0.001;\r\n\t\tconst stepTrans = timeDelta_s * 100;\r\n\t\tconst stepRot = timeDelta_s * Math.PI * 0.5;\r\n\t\tlastTime = time;\r\n\t\tif (inputControlDuke.checked) {\r\n\t\t\t// https://stackoverflow.com/questions/25207293/rotating-a-group-of-vectors/25216549#25216549\r\n\t\t\tfunction addToTranslation(m: twgl.m4.Mat4, v: twgl.v3.Vec3) { m[12] += v[0]; m[13] += v[1]; m[14] += v[2]; }\r\n\t\t\tif (!lastInputControlDuke_checked) {\r\n\t\t\t\tconst v2 = twgl.m4.getAxis(droneMatrix, 2);\r\n\t\t\t\tconst v0 = twgl.v3.normalize(twgl.v3.cross([0, 1, 0,], v2));\r\n\t\t\t\ttwgl.m4.setAxis(droneMatrix, v0, 0, droneMatrix);\r\n\t\t\t\ttwgl.m4.setAxis(droneMatrix, twgl.v3.cross(v2, v0, v0), 1, droneMatrix);\r\n\t\t\t}\r\n\t\t\tif (keys.KeyW) twgl.m4.translate(droneMatrix, [0, 0, -stepTrans,], droneMatrix);\r\n\t\t\tif (keys.KeyS) twgl.m4.translate(droneMatrix, [0, 0, stepTrans,], droneMatrix);\r\n\t\t\tif (keys.KeyA) {\r\n\t\t\t\tconst v2: twgl.v3.Vec3 = [droneMatrix[0], 0, droneMatrix[2],];\r\n\t\t\t\taddToTranslation(droneMatrix, twgl.v3.mulScalar(twgl.v3.normalize(v2, v2), -stepTrans, v2));\r\n\t\t\t}\r\n\t\t\tif (keys.KeyD) {\r\n\t\t\t\tconst v2: twgl.v3.Vec3 = [droneMatrix[0], 0, droneMatrix[2],];\r\n\t\t\t\taddToTranslation(droneMatrix, twgl.v3.mulScalar(twgl.v3.normalize(v2, v2), stepTrans, v2));\r\n\t\t\t}\r\n\t\t\tif (keys.ControlLeft) droneMatrix[13] -= stepTrans * Math.sign(droneMatrix[5]);\r\n\t\t\tif (keys.Space) droneMatrix[13] += stepTrans * Math.sign(droneMatrix[5]);\r\n\t\t\tif (keys.ArrowLeft) {\r\n\t\t\t\tconst transl = twgl.m4.getTranslation(droneMatrix);\r\n\t\t\t\ttwgl.m4.multiply(twgl.m4.axisRotation([0, 1, 0,], stepRot), droneMatrix, droneMatrix);\r\n\t\t\t\ttwgl.m4.setTranslation(droneMatrix, transl, droneMatrix);\r\n\t\t\t}\r\n\t\t\tif (keys.ArrowRight) {\r\n\t\t\t\tconst transl = twgl.m4.getTranslation(droneMatrix);\r\n\t\t\t\ttwgl.m4.multiply(twgl.m4.axisRotation([0, 1, 0,], -stepRot), droneMatrix, droneMatrix);\r\n\t\t\t\ttwgl.m4.setTranslation(droneMatrix, transl, droneMatrix);\r\n\t\t\t}\r\n\t\t\tif (keys.ArrowUp) twgl.m4.rotateX(droneMatrix, -stepRot, droneMatrix);\r\n\t\t\tif (keys.ArrowDown) twgl.m4.rotateX(droneMatrix, stepRot, droneMatrix);\r\n\r\n\t\t\t[stickL, stickR,].forEach(s => s.off());\r\n\t\t} else if (inputControlRC.checked || inputControlGamepad.checked || inputControlKb.checked) {\r\n\t\t\tlet resL = { x: 0, y: 0, };\r\n\t\t\tlet resR = { x: 0, y: 0, };\r\n\t\t\tconst gamepadState = gamepadMgr.updateAndGetState(inputControlRC.checked);\r\n\t\t\tinputControlRC.disabled = inputControlGamepad.disabled = !gamepadState.connected;\r\n\t\t\tif (gamepadState.connected && (inputControlRC.checked || inputControlGamepad.checked)) {\r\n\t\t\t\tresL = { x: gamepadState.ch4, y: gamepadState.ch3, };\r\n\t\t\t\tresR = { x: gamepadState.ch1, y: gamepadState.ch2, };\r\n\t\t\t\tstickL.set(resL.x, resL.y);\r\n\t\t\t\tstickR.set(resR.x, resR.y);\r\n\t\t\t} else {\r\n\t\t\t\tresL = stickL.update(timeDelta_s, keys.KeyA, keys.KeyD, keys.KeyW, keys.KeyS);\r\n\t\t\t\tresR = stickR.update(timeDelta_s, keys.ArrowLeft, keys.ArrowRight, keys.ArrowUp, keys.ArrowDown);\r\n\t\t\t}\r\n\t\t\t[resL.x, resL.y, resR.x, resR.y,].forEach((n, i) => spanLRxy[i].innerText = n.toFixed(10));\r\n\r\n\t\t\ttwgl.m4.rotateZ(droneMatrix, -timeDelta_s * degToRad(getBetaflightRates(resR.x, 0.4, 1.5, 0)), droneMatrix);\t// roll\r\n\t\t\ttwgl.m4.rotateX(droneMatrix, -timeDelta_s * degToRad(getBetaflightRates(resR.y, 0.4, 1.5, 0)), droneMatrix);\t// pitch\r\n\t\t\ttwgl.m4.rotateY(droneMatrix, -timeDelta_s * degToRad(getBetaflightRates(resL.x, 0.4, 1.5, 0)), droneMatrix);\t// yaw\r\n\t\t\t// http://paulnurkkala.com/nurks-betaflight-4-1-rpm-filtering-pids-and-setup-for-freestyle/\r\n\t\t\t//twgl.m4.rotateZ(droneMatrix, -timeDelta_s * degToRad(getBetaflightRates(resR.x, 0.83, 0.8, 0)), droneMatrix);\t// roll\r\n\t\t\t//twgl.m4.rotateX(droneMatrix, -timeDelta_s * degToRad(getBetaflightRates(resR.y, 0.83, 0.8, 0)), droneMatrix);\t// pitch\r\n\t\t\t//twgl.m4.rotateY(droneMatrix, -timeDelta_s * degToRad(getBetaflightRates(resL.x, 0.7, 0.8, 0)), droneMatrix);\t// yaw\r\n\r\n\t\t\t// engine thrust, https://www.grc.nasa.gov/www/k-12/VirtualAero/BottleRocket/airplane/falling.html\r\n\t\t\tconst g = 9.8;\r\n\t\t\tconst drag = 0.01;\r\n\t\t\tconst thrust = (resL.y + 1) * 31.3;\t// m/s\r\n\t\t\tconst dv0 = droneMatrix[4] * thrust - cameraVelocity[0];\r\n\t\t\tconst dv1 = droneMatrix[5] * thrust - cameraVelocity[1];\r\n\t\t\tconst dv2 = droneMatrix[6] * thrust - cameraVelocity[2];\r\n\t\t\tcameraVelocity[0] += drag * dv0 * Math.abs(dv0) * timeDelta_s;\r\n\t\t\tcameraVelocity[1] += drag * dv1 * Math.abs(dv1) * timeDelta_s - g * timeDelta_s;\t\t// -gravity\r\n\t\t\tcameraVelocity[2] += drag * dv2 * Math.abs(dv2) * timeDelta_s;\r\n\r\n\t\t\tdroneMatrix[12] += cameraVelocity[0] * timeDelta_s;\r\n\t\t\tdroneMatrix[13] += cameraVelocity[1] * timeDelta_s;\r\n\t\t\tdroneMatrix[14] += cameraVelocity[2] * timeDelta_s;\r\n\t\t\tif (droneMatrix[13] < 0.2) {\r\n\t\t\t\tcameraVelocity[0] = cameraVelocity[1] = cameraVelocity[2] = 0;\r\n\t\t\t\tdroneMatrix[13] = 0.2;\r\n\t\t\t\t// todo: adjust matrix horizontally\r\n\t\t\t}\r\n\r\n\t\t\tspanPosition.forEach((span, i) => span.innerText = `${Math.round(droneMatrix[12 + i])}`);\r\n\t\t\tspanVelocity.forEach((span, i) => span.innerText = `${Math.round(cameraVelocity[i] * 3.6)}`);\r\n\t\t\t//spanPosition[2].innerText += `,  v1: ${v1}, dv1: ${dv1}`;\r\n\t\t}\r\n\t\tlastInputControlDuke_checked = inputControlDuke.checked;\r\n\r\n\t\ttime = 5 + time * 0.00001;\r\n\r\n\t\ttwgl.resizeCanvasToDisplaySize(canvas);\r\n\r\n\r\n\t\tconst projectionMatrix = twgl.m4.perspective(degToRad(90), 1, 0.1, 2000);\t// Compute the projection matrix\r\n\t\tconst cameraMatrix = twgl.m4.rotateX(droneMatrix, degToRad(getCameraAngle()));\r\n\r\n\t\t//////////////////\r\n\t\t[{ fbi: 0, rotX: 0, rotY: -Math.PI / 2, rotZ: Math.PI, }, { fbi: 1, rotX: 0, rotY: Math.PI / 2, rotZ: Math.PI, },\r\n\t\t\t{ fbi: 2, rotX: Math.PI / 2, rotY: 0, rotZ: 0, }, { fbi: 3, rotX: -Math.PI / 2, rotY: 0, rotZ: 0, },\r\n\t\t\t{ fbi: 4, rotX: Math.PI, rotY: 0, rotZ: 0, }, { fbi: 5, rotX: 0, rotY: 0, rotZ: Math.PI, },\r\n\t\t].forEach(i => {\r\n\r\n\t\t\tconst cameraMatrix3 = twgl.m4.rotateZ(twgl.m4.rotateY(twgl.m4.rotateX(cameraMatrix, i.rotX), i.rotY), i.rotZ);\r\n\t\t\tconst viewMatrix3 = twgl.m4.inverse(cameraMatrix3);\r\n\t\t\tconst viewProjectionMatrix3 = twgl.m4.multiply(projectionMatrix, viewMatrix3);\r\n\r\n\t\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, fbs[i.fbi].fb);\t// render to our targetTexture by binding the framebuffer\r\n\t\t\tgl.viewport(0, 0, targetTextureWH, targetTextureWH);\t// Tell WebGL how to convert from clip space to pixels\r\n\r\n\t\t\tgl.enable(gl.CULL_FACE);\r\n\t\t\tgl.enable(gl.DEPTH_TEST);\r\n\r\n\t\t\tgl.clearColor(1, 1, 1, 1);\r\n\t\t\tgl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\t// Clear the canvas AND the depth buffer.\r\n\r\n\t\t\tgl.useProgram(auxProgram.program);\r\n\t\t\tgl.bindVertexArray(auxProgram.vao);\t// Setup all the needed attributes.\r\n\r\n\t\t\tgl.uniformMatrix4fv(u_viewInverse, false, cameraMatrix3);\r\n\t\t\tgl.uniform3fv(u_lightWorldPos, [-50, 30, 100]);\r\n\t\t\tgl.uniform4fv(u_lightColor, [1, 1, 1, 1]);\r\n\r\n\t\t\t// Draw objects\r\n\t\t\tobjects.forEach(object => {\r\n\r\n\t\t\t\t// Compute a position for this object based on the time.\r\n\t\t\t\tconst worldMatrix = twgl.m4.identity();\r\n\t\t\t\ttwgl.m4.translate(worldMatrix, [0, 50, 0,], worldMatrix);\r\n\t\t\t\ttwgl.m4.rotateY(worldMatrix, object.yRotation * time, worldMatrix);\r\n\t\t\t\ttwgl.m4.rotateX(worldMatrix, object.xRotation * time, worldMatrix);\r\n\t\t\t\ttwgl.m4.translate(worldMatrix, [0, 0, object.radius,], worldMatrix);\r\n\r\n\t\t\t\t// Multiply the matrices.\r\n\t\t\t\ttwgl.m4.multiply(viewProjectionMatrix3, worldMatrix, worldViewProjection);\r\n\t\t\t\ttwgl.m4.transpose(twgl.m4.inverse(worldMatrix), worldInverseTranspose);\r\n\r\n\t\t\t\t// Set the uniforms we just computed\r\n\t\t\t\tgl.uniformMatrix4fv(u_world, false, worldMatrix);\r\n\t\t\t\tgl.uniformMatrix4fv(u_worldViewProjection, false, worldViewProjection);\r\n\t\t\t\tgl.uniformMatrix4fv(u_worldInverseTranspose, false, worldInverseTranspose);\r\n\r\n\t\t\t\t// Set the uniforms that are specific to the this object.\r\n\t\t\t\tgl.uniform4fv(u_colorMult, object.materialUniforms.u_colorMult);\r\n\t\t\t\tgl.uniform4fv(u_specular, object.materialUniforms.u_specular);\r\n\t\t\t\tgl.uniform1f(u_shininess, object.materialUniforms.u_shininess);\r\n\t\t\t\tgl.uniform1f(u_specularFactor, object.materialUniforms.u_specularFactor);\r\n\t\t\t\tgl.uniform1i(u_diffuse, 0);\r\n\t\t\t\tgl.activeTexture(gl.TEXTURE0 + 0);\r\n\t\t\t\tgl.bindTexture(gl.TEXTURE_2D, object.materialUniforms.u_diffuse);\r\n\r\n\t\t\t\tgl.drawElements(gl.TRIANGLES, envData.indices.length, gl.UNSIGNED_SHORT, 0);\t// Draw the geometry.\r\n\t\t\t});\r\n\r\n\t\t\t// ------ Draw the plane --------\r\n\t\t\t{\r\n\t\t\t\tgl.bindVertexArray(planeVAO);\t// Setup all the needed attributes.\r\n\r\n\t\t\t\t// Compute a position for this object based on the time.\r\n\t\t\t\tlet worldMatrix = twgl.m4.identity();\r\n\t\t\t\tworldMatrix = twgl.m4.translate(worldMatrix, [0, 0, 100,]);\r\n\t\t\t\tworldMatrix = twgl.m4.scale(worldMatrix, [10, 1, 10,]);\r\n\r\n\t\t\t\t// Multiply the matrices.\r\n\t\t\t\ttwgl.m4.multiply(viewProjectionMatrix3, worldMatrix, worldViewProjection);\r\n\t\t\t\ttwgl.m4.transpose(twgl.m4.inverse(worldMatrix), worldInverseTranspose);\r\n\r\n\t\t\t\t// Set the uniforms we just computed\r\n\t\t\t\tgl.uniformMatrix4fv(u_world, false, worldMatrix);\r\n\t\t\t\tgl.uniformMatrix4fv(u_worldViewProjection, false, worldViewProjection);\r\n\t\t\t\tgl.uniformMatrix4fv(u_worldInverseTranspose, false, worldInverseTranspose);\r\n\r\n\t\t\t\t// Set the uniforms that are specific to the this object.\r\n\t\t\t\tgl.uniform4fv(u_colorMult, [1,1,1,1]);\r\n\t\t\t\tgl.uniform4fv(u_specular, [1, 1, 1, 1]);\r\n\t\t\t\tgl.uniform1f(u_shininess, 100);\r\n\t\t\t\tgl.uniform1f(u_specularFactor, 0.5);\r\n\t\t\t\tgl.uniform1i(u_diffuse, 0);\r\n\t\t\t\tgl.activeTexture(gl.TEXTURE0 + 0);\r\n\t\t\t\tgl.bindTexture(gl.TEXTURE_2D, checkerboardTexture);\r\n\r\n\t\t\t\tgl.disable(gl.CULL_FACE);\r\n\t\t\t\tgl.drawElements(gl.TRIANGLES, planeData.indices.length, gl.UNSIGNED_SHORT, 0);\t// Draw the geometry.\r\n\t\t\t}\r\n\t\t});\r\n\r\n\r\n\t\t//////////////////\r\n\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, null);\t// render to the canvas\r\n\t\tgl.bindTexture(gl.TEXTURE_CUBE_MAP, targetTexture);\t// render the cube with the texture we just rendered to\r\n\t\tgl.generateMipmap(gl.TEXTURE_CUBE_MAP);\r\n\t\tgl.viewport(0, 0, canvas.width, canvas.height);\t// Tell WebGL how to convert from clip space to pixels\r\n\r\n\t\tgl.clearColor(1, 1, 1, 1);   // clear to white\r\n\t\tgl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\t// Clear the canvas AND the depth buffer.\r\n\r\n\t\t// draw the skybox\r\n\t\tgl.depthFunc(gl.LEQUAL);\t// let our quad pass the depth test at 1.0\r\n\t\tgl.useProgram(auxProgramSky.program);\r\n\t\tgl.bindVertexArray(auxProgramSky.vao);\r\n\t\tgl.uniform1i(u_skybox, 0);\r\n\t\tgl.uniform1f(u_aspect, canvas.clientWidth / canvas.clientHeight);\t// 4/3, 16/9\r\n\t\tgl.uniform1f(u_fov, degToRad(getFov()));\r\n\t\tgl.drawElements(gl.TRIANGLES, 6, gl.UNSIGNED_SHORT, 0);\r\n\r\n\r\n\t\trequestAnimationFrame(drawScene);\r\n\t}\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nfunction createWebGLHelper(canvas: HTMLCanvasElement) {\r\n\r\n\tconst gl = canvas.getContext(\"webgl2\")!;\r\n\tif (!gl) {\r\n\t\tconst message = \"Unable to initialize WebGL. Your browser may not support it.\";\r\n\t\talert(message);\r\n\t\tthrow new Error(message);\r\n\t}\r\n\r\n\treturn { gl, createProgram, createAndBindTexture, createAndBindFramebuffer, glEnumToString, };\r\n\r\n\r\n\r\n\tfunction createProgram(vertexSource: string, fragmentSource: string,\r\n\t\tbuffers: { attributeName: string, bufferData: Float32Array, indexBufferData?: Uint16Array, onePointSize: number, normalize: boolean, }[]\r\n\t) {\r\n\r\n\t\tconst vertexShader = createShader(gl.VERTEX_SHADER, vertexSource);\r\n\t\tconst fragmentShader = createShader(gl.FRAGMENT_SHADER, fragmentSource);\r\n\r\n\t\tconst program = gl.createProgram()!;\r\n\t\tgl.attachShader(program, vertexShader);\r\n\t\tgl.attachShader(program, fragmentShader);\r\n\t\tgl.linkProgram(program);\r\n\r\n\t\tif (!gl.getProgramParameter(program, gl.LINK_STATUS))\r\n\t\t\tthrow new Error(\"Could not compile WebGL program. \\n\\n\" + gl.getProgramInfoLog(program));\r\n\r\n\t\tconst attribLocations = buffers.map(b => gl.getAttribLocation(program, b.attributeName));\r\n\t\tconst vao = createVAO(buffers);\r\n\r\n\t\treturn { program, vao, getUniformLocation, createVAO, };\r\n\r\n\r\n\t\tfunction getUniformLocation(name: string) { return gl.getUniformLocation(program, name); }\r\n\r\n\t\tfunction createVAO(buffers: { bufferData: Float32Array, indexBufferData?: Uint16Array, onePointSize: number, normalize: boolean, }[]) {\r\n\t\t\tconst vao = gl.createVertexArray();\r\n\t\t\tgl.bindVertexArray(vao);\r\n\t\t\tbuffers.forEach((b, i) => {\r\n\t\t\t\tgl.enableVertexAttribArray(attribLocations[i]);\r\n\t\t\t\tconst buffer = gl.createBuffer();\r\n\t\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, buffer);\r\n\t\t\t\tgl.bufferData(gl.ARRAY_BUFFER, b.bufferData, gl.STATIC_DRAW);\r\n\t\t\t\tgl.vertexAttribPointer(attribLocations[i], b.onePointSize, gl.FLOAT, b.normalize, 0, 0);\r\n\r\n\t\t\t\tif (b.indexBufferData) {\r\n\t\t\t\t\tconst indexBuffer = gl.createBuffer();\r\n\t\t\t\t\tgl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, indexBuffer);\r\n\t\t\t\t\tgl.bufferData(gl.ELEMENT_ARRAY_BUFFER, b.indexBufferData, gl.STATIC_DRAW);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn vao;\r\n\t\t}\r\n\r\n\t\tfunction createShader(type: number, source: string) {\r\n\t\t\tconst shader = gl.createShader(type)!;\r\n\t\t\tgl.shaderSource(shader, source);\r\n\t\t\tgl.compileShader(shader);\r\n\t\t\tif (!gl.getShaderParameter(shader, gl.COMPILE_STATUS))\r\n\t\t\t\tthrow new Error(\"Could not compile WebGL program. \\n\\n\" + gl.getShaderInfoLog(shader));\r\n\t\t\treturn shader\r\n\t\t}\r\n\t}\r\n\r\n\tfunction createAndBindTexture(target: GLenum = gl.TEXTURE_2D) {\r\n\t\tconst texture = gl.createTexture();\r\n\t\tgl.bindTexture(target, texture);\r\n\t\treturn texture;\r\n\t}\r\n\r\n\tfunction createAndBindFramebuffer() {\r\n\t\tconst fb = gl.createFramebuffer();\r\n\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, fb);\r\n\t\treturn fb;\r\n\t}\r\n\r\n\tfunction glEnumToString(value: number) {\r\n\t\tfor (const key in gl)\r\n\t\t\tif (gl[key] === value)\r\n\t\t\t\treturn key;\r\n\t\treturn `0x${value.toString(16)}`;\r\n\t}\r\n}\r\n\r\n\r\n\r\nfunction createFps(divFps: HTMLElement) {\r\n\r\n\tlet last = 0;\r\n\tlet frames2 = 0;\r\n\tloop();\r\n\treturn { inc: () => frames2++, };\r\n\r\n\tasync function loop() {\r\n\t\twhile (true) {\r\n\t\t\tdivFps.innerText = `fps: ${frames2 - last}`;\r\n\t\t\tlast = frames2;\r\n\t\t\tawait setTimeoutA(1400 - new Date().getMilliseconds());\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\n\r\nfunction createStick(upDownWithSpring: boolean) {\r\n\r\n\tlet stick: SVGPathElement;\r\n\tconst svg =\r\n\t\t<svg style={{ width: \"50px\", height: \"50px\", border: \"1px solid #ccc\", borderRadius: \"7px\", }}>\r\n\t\t\t{stick = <path style={{ fill: \"none\", stroke: \"#888\", strokeWidth: \"1.5\", }} /> as any as SVGPathElement}\r\n\t\t</svg>;\r\n\tlet [x, y,] = [0, 0,];\r\n\r\n\treturn { svg, update, off, set, };\r\n\r\n\tfunction update(timeDelta_s: number, left: boolean, right: boolean, up: boolean, down: boolean) {\r\n\t\tconst step1 = timeDelta_s * 2;\r\n\t\tconst step2 = timeDelta_s * 1;\r\n\t\tx = updateAux(x, left, right, step1, step2, true);\r\n\t\ty = updateAux(y, down, up, step1, step2, upDownWithSpring);\r\n\t\tset(x, y);\r\n\t\treturn { x, y, };\r\n\t}\r\n\tfunction updateAux(x: number, left: boolean, right: boolean, step1: number, step2: number, withSpring: boolean) {\r\n\t\tif (left && !right) {\r\n\t\t\tif (x < 0)\r\n\t\t\t\tx = Math.max(x - step1, -1);\r\n\t\t\telse\r\n\t\t\t\tx = Math.max(x - step1 - step2, -1);\r\n\t\t} else if (!left && right) {\r\n\t\t\tif (x > 0)\r\n\t\t\t\tx = Math.min(x + step1, 1);\r\n\t\t\telse\r\n\t\t\t\tx = Math.min(x + step1 + step2, 1);\r\n\t\t} else if (!left && !right && withSpring) {\r\n\t\t\tif (x < 0)\r\n\t\t\t\tx = Math.min(x + step2, 0);\r\n\t\t\telse if (x > 0)\r\n\t\t\t\tx = Math.max(x - step2, 0);\r\n\t\t}\r\n\t\treturn x;\r\n\t}\r\n\tfunction off() { setAttrSvg(stick, { d: \"\", }); }\r\n\tfunction set(x: number, y: number) {\r\n\t\tconst x2 = x * 18 + 25;\r\n\t\tconst y2 = -y * 18 + 25;\r\n\t\tsetAttrSvg(stick, { d: `M${x2 - 5},${y2} h10 M${x2},${y2 - 5} v10`, });\r\n\t}\r\n}\r\n\r\n\r\n\r\nfunction createGamepadManager() {\r\n\t// https://developer.mozilla.org/en-US/docs/Web/API/Gamepad_API/Using_the_Gamepad_API\r\n\r\n\tconst state = { connected: false, ch1: 0, ch2: 0, ch3: 0, ch4: 0, };\r\n\r\n\treturn { updateAndGetState, };\r\n\r\n\tfunction updateAndGetState(rc: boolean) {\r\n\t\tconst gamepads: Gamepad[] = navigator.getGamepads ? navigator.getGamepads() : (navigator as any).webkitGetGamepads ? (navigator as any).webkitGetGamepads() : [];\r\n\t\tstate.connected = gamepads.length > 0;\r\n\t\t//const auxxxxx = state.ch4;\r\n\t\tif (rc) {\r\n\t\t\t// Jumper T8SG & FeiYing, kmita to vzdy mezi -0.8117647058823529 a -0.803921568627451, ale kdyz dam to 0.80..., tak se lip zarovna nulova hodnota\r\n\t\t\tstate.ch1 = linInp(getCh(gamepads, 0), -0.803921568627451, 0.7647058823529411, -1, 1);\r\n\t\t\tstate.ch2 = linInp(getCh(gamepads, 1), -0.803921568627451, 0.7647058823529411, -1, 1);\r\n\t\t\tstate.ch3 = linInp(getCh(gamepads, 2), -0.803921568627451, 0.7647058823529411, -1, 1);\r\n\t\t\tstate.ch4 = linInp(getCh(gamepads, 4), -0.803921568627451, 0.7647058823529411, -1, 1);\r\n\t\t\t// Jumper T8SG usb direct\r\n\t\t\t//state.ch1 = linInp(getCh(gamepads, 0), -0.984251968503937, 0.984251968503937, -1, 1);\r\n\t\t\t//state.ch2 = linInp(getCh(gamepads, 1), -0.7874015748031495, 0.7874015748031495, -1, 1);\r\n\t\t\t//state.ch3 = linInp(getCh(gamepads, 2), -0.7874015748031495, 0.7874015748031495, -1, 1);\r\n\t\t\t//state.ch4 = linInp(getCh(gamepads, 3), -0.7874015748031495, 0.7874015748031495, -1, 1);\r\n\t\t} else {\r\n\t\t\t// gamepad, nintendo switch pro controller, nefunguje to ve ff (nektera tlacitka fungovaly, ale osy ne), v chromu slo vsechno. napodruhy mi uz nefungovalo nikde nic. pak pri pripojeni usb kabelem to fungovalo zas jen v chromu\r\n\t\t\tstate.ch1 = deadband(linInp(getCh(gamepads, 2), -1, 1, -1, 1), 0.17);\r\n\t\t\tstate.ch2 = deadband(linInp(getCh(gamepads, 3), 1, -1, -1, 1), 0.17);\r\n\t\t\tstate.ch3 = deadband(linInp(getCh(gamepads, 1), 1, -1, -1, 1), 0.17);\r\n\t\t\tstate.ch4 = deadband(linInp(getCh(gamepads, 0), -1, 1, -1, 1), 0.17);\r\n\t\t}\r\n\t\t//if (state.ch4 !== auxxxxx)\r\n\t\t//\tconsole.log(state.ch4);\r\n\t\treturn state;\r\n\t}\r\n\tfunction getCh(gamepads: Gamepad[], axis: number) {\r\n\t\treturn gamepads[0]?.axes[axis] ?? 0;\r\n\t}\r\n\tfunction deadband(value: number, dead: number) {\r\n\t\treturn Math.max(Math.abs(value) - dead, 0) / (1 - dead) * Math.sign(value);\r\n\t}\r\n}\r\n\r\nfunction drawOsd(osd: HTMLCanvasElement) {\r\n\tconst c = osd.getContext(\"2d\")!;\r\n\tcircle(\"#fff\", 2);\r\n\tcircle(\"#000\", 1);\r\n\tfunction circle(color: string, width: number) {\r\n\t\tc.beginPath();\r\n\t\tc.strokeStyle = color;\r\n\t\tc.lineWidth = width;\r\n\t\tc.arc(640 / 2, 480 / 2, 5, 0, 2 * Math.PI);\r\n\t\tc.stroke();\r\n\t}\r\n}\r\n\r\n\r\n\r\n// https://github.com/betaflight/betaflight/blob/master/src/main/fc/rc.c#L155 applyBetaflightRates\r\n// https://github.com/betaflight/betaflight-configurator/blob/master/src/js/RateCurve.js#L81 getBetaflightRates\r\nfunction getBetaflightRates(rcCommandf: number, rate: number, rcRate: number, rcExpo: number) {\r\n\r\n\tconst rcCommandfAbs = Math.abs(rcCommandf);\r\n\tconst limit = 1998;\r\n\r\n\tlet angularVel;\r\n\r\n\tif (rcRate > 2) {\r\n\t\trcRate = rcRate + (rcRate - 2) * 14.54;\r\n\t}\r\n\r\n\tconst expoPower = 3;\r\n\tconst rcRateConstant = 200;\r\n\r\n\tif (rcExpo > 0) {\r\n\t\trcCommandf = rcCommandf * Math.pow(rcCommandfAbs, expoPower) * rcExpo + rcCommandf * (1 - rcExpo);\r\n\t}\r\n\r\n\tconst rcFactor = 1 / constrain(1 - rcCommandfAbs * rate, 0.01, 1);\r\n\tangularVel = rcRateConstant * rcRate * rcCommandf;\r\n\tangularVel = angularVel * rcFactor;\r\n\r\n\tangularVel = constrain(angularVel, -1 * limit, limit); // Rate limit from profile\r\n\r\n\treturn angularVel;\r\n}\r\n\r\nfunction constrain(value: number, min: number, max: number) {\r\n\treturn Math.max(min, Math.min(value, max));\r\n}\r\n\r\n"]}